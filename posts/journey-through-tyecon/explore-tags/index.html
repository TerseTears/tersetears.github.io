






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>Journey Through `tyecon`: Exploring Food.com Tags &middot; Mohamad Ali Mohamadi</title>
    <meta name="title" content="Journey Through `tyecon`: Exploring Food.com Tags &middot; Mohamad Ali Mohamadi" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js"
    integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.3e97d1a40161cd59b059d44499fc9d982d868881f1450889ca07e646a9fb3a8e.css"
    integrity="sha256-PpfRpAFhzVmwWdREmfydmC2GiIHxRQiJygfmRqn7Oo4="
  />
  
    
    
    
  
  
  
    
    
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.f29ffdffd9ab4cc95250c3c7196b2d5dae8ee6ef0a4139451073f90183ae7e31.js"
      integrity="sha256-8p/9/9mrTMlSUMPHGWstXa6O5u8KQTlFEHP5AYOufjE="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        Introduction #I&rsquo;ve been working on my R package, tyecon for some time now.
      
    "
  />
  
  
  
  <link rel="canonical" href="https://tersetears.github.io/posts/journey-through-tyecon/explore-tags/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:title" content="Journey Through `tyecon`: Exploring Food.com Tags" />
<meta property="og:description" content="Introduction #I&rsquo;ve been working on my R package, tyecon for some time now." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tersetears.github.io/posts/journey-through-tyecon/explore-tags/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-06-01T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Journey Through `tyecon`: Exploring Food.com Tags"/>
<meta name="twitter:description" content="Introduction #I&rsquo;ve been working on my R package, tyecon for some time now."/>

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Journey Through \u0060tyecon\u0060: Exploring Food.com Tags",
    "headline": "Journey Through \u0060tyecon\u0060: Exploring Food.com Tags",
    
    "abstract": "Introduction #I\u0026rsquo;ve been working on my R package, tyecon for some time now.",
    "inLanguage": "en",
    "url" : "https:\/\/tersetears.github.io\/posts\/journey-through-tyecon\/explore-tags\/",
    "author" : {
      "@type": "Person",
      "name": "Mohamad Ali Mohamadi"
    },
    "copyrightYear": "2022",
    "dateCreated": "2022-06-01T00:00:00\u002b00:00",
    "datePublished": "2022-06-01T00:00:00\u002b00:00",
    
    "dateModified": "2022-06-01T00:00:00\u002b00:00",
    
    "keywords": ["R","tyecon"],
    
    "mainEntityOfPage": "true",
    "wordCount": "1087"
  }
  </script>
    
    <script type="application/ld+json">
    {
   "@context": "https://schema.org",
   "@type": "BreadcrumbList",
   "itemListElement": [
     {
       "@type": "ListItem",
       "item": "https://tersetears.github.io/",
       "name": "Mohamad Ali Mohamadi",
       "position": 1
     },
     {
       "@type": "ListItem",
       "item": "https://tersetears.github.io/posts/",
       "name": "Posts",
       "position": 2
     },
     {
       "@type": "ListItem",
       "item": "https://tersetears.github.io/categories/programming/",
       "name": "programming",
       "position": 3
     },
     {
       "@type": "ListItem",
       "name": "Journey Through `Tyecon` Exploring Food.com Tags",
       "position": 4
     }
   ]
 }
  </script>

  
  <meta name="author" content="Mohamad Ali Mohamadi" />
  
    
      <link href="TerseTears@protonmail.com" rel="me" />
    
      <link href="https://github.com/tersetears" rel="me" />
    
      <link href="https://linkedin.com/in/mohamad-ali-mohamadi-b799582ab" rel="me" />
    
  
  
  






  
  
  
  
  
  


  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >Mohamad Ali Mohamadi</a
  >

    </div>
    
    
      <ul class="flex list-none flex-col text-end sm:flex-row">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/posts/"
                  title="Posts"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/categories/"
                  title="Categories"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/tags/"
                  title="Tags"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                
                
                  <button
                    id="search-button-1"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
            
              
          
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Journey Through `tyecon`: Exploring Food.com Tags
      </h1>
      
        <div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2022-06-01 00:00:00 &#43;0000 UTC">1 June 2022</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">6 mins</span>
    

    
    
  </div>

  
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <h2 id="introduction" class="relative group">Introduction <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#introduction" aria-label="Anchor">#</a></span></h2><p>I&rsquo;ve been working on my R package,
<a href="https://github.com/TerseTears/tyecon" target="_blank" rel="noreferrer">tyecon</a> for some time now. I think it
can be a useful tool in performing day to day data analysis tasks. The idea is
very simple: More higher order macros. There&rsquo;s no reason to focus on
the handful of existing ones, like the <code>magrittr</code> pipes or the <code>dplyr</code> syntax.
We have a language here that supports lazy evaluation and first class
functions. This is all we need to make programming life easier.</p>
<p>Data analysis tasks are quite unique. And it&rsquo;s not always clear what the best
approach towards writing less code could be. Nevertheless, I think searching
for such possibilities is a legitimate endeavour, hence <code>tyecon</code>.</p>
<p>In this first part of the &ldquo;Journey through <code>tyecon</code>&rdquo; series, I explore the tags
found in the
<a href="https://www.kaggle.com/datasets/shuyangli94/food-com-recipes-and-user-interactions" target="_blank" rel="noreferrer">Food.com</a>
dataset. I forgo mentioning specifically when I&rsquo;m using any <code>tyecon</code>
functionality, but that should be obvious from the code.</p>
<h2 id="setup-and-data-import" class="relative group">Setup and Data Import <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#setup-and-data-import" aria-label="Anchor">#</a></span></h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyselect</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">vroom</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">rlang</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tyecon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">knitr</span><span class="o">::</span><span class="n">opts_chunk</span><span class="o">$</span><span class="nf">set</span><span class="p">(</span><span class="n">fig.path</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">knitr</span><span class="o">::</span><span class="n">opts_chunk</span><span class="o">$</span><span class="nf">set</span><span class="p">(</span><span class="n">dev</span> <span class="o">=</span> <span class="s">&#39;svg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_light</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">recipes</span> <span class="o">&lt;-</span> <span class="nf">vroom</span><span class="p">(</span><span class="s">&#34;~/Workspace/foodrecipes/RAW_recipes.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">interacts</span> <span class="o">&lt;-</span> <span class="nf">vroom</span><span class="p">(</span><span class="s">&#34;~/Workspace/foodrecipes/RAW_interactions.csv&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="tags" class="relative group">Tags <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#tags" aria-label="Anchor">#</a></span></h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tags</span> <span class="o">&lt;-</span> <span class="n">recipes</span> <span class="o">%-&gt;%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">tag</span> <span class="o">=</span> <span class="nf">str_replace_all</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="s">&#34;[\\[\\]\\&#39;]&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">tags</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">tag</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nf">separate_rows</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;, &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># convert to conventional R names</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">tag</span> <span class="o">=</span> <span class="nf">make.names</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Number of tags density plot:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tags</span> <span class="o">%-&gt;%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">n_tags</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">%$%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">quantprob</span> <span class="o">&lt;-</span> <span class="m">0.9</span>
</span></span><span class="line"><span class="cl">  <span class="n">quant</span> <span class="o">&lt;-</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">n_tags</span><span class="p">,</span> <span class="n">quantprob</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="n">.,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">n_tags</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">geom_density</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="n">quant</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;label&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">quant</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="nf">glue</span><span class="p">(</span><span class="s">&#34;Quantile probability {quantprob}:\n {quant}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">xlab</span><span class="p">(</span><span class="s">&#34;Number of tags&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ylab</span><span class="p">(</span><span class="s">&#34;Density&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>





<figure>
    
    








  
    
    
    
    
      
    
    
      
    
    
    
    
    <picture  class="mx-auto my-0 rounded-md" >
      <img
        src="/posts/journey-through-tyecon/explore-tags/quantile-1.svg"
        width="576"
        height="432"
        class="mx-auto my-0 rounded-md"
        alt="plot of chunk quantile"
        loading="lazy" decoding="async"
      />
    </picture>
  


</figure>
</p>
<p>Therefore, We would still need a lot of tags for basic exploration of our data.
Let us first create the tag dummies for each submitted recipe:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tags_dummies</span> <span class="o">&lt;-</span> <span class="n">tags</span> <span class="o">%-&gt;%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">add_count</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">tagged</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pivot_wider</span><span class="p">(</span><span class="n">names_from</span> <span class="o">=</span> <span class="n">tag</span><span class="p">,</span> <span class="n">values_from</span> <span class="o">=</span> <span class="n">tagged</span><span class="p">,</span> <span class="n">values_fill</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># keep id as metadata</span>
</span></span><span class="line"><span class="cl">  <span class="n">ids</span> <span class="o">&lt;-</span> <span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">set_attr</span><span class="p">(</span><span class="s">&#34;ids&#34;</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The columns of the above data frame are thus sorted in order of tag frequency.</p>
<p>The strategy is to identify how much of the data is covered by a list of tags,
and to append the list with a new tag and recompute the coverage rate. Starting
from highly popular tags quickly culminates in a coverage rate of 1, so we are
instead interested in whether a less popular subset still covers all of our
observations.</p>
<p>Consequently, let&rsquo;s assume a coverage rate of 1 for the first few tags and then
compute the coverage rate from thereon:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tags_coverage</span> <span class="o">&lt;-</span> <span class="n">tags_dummies</span> <span class="o">%-&gt;%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">start</span> <span class="o">&lt;-</span> <span class="m">11</span>
</span></span><span class="line"><span class="cl">  <span class="n">coverage_name</span> <span class="o">&lt;-</span> <span class="nf">as.character</span><span class="p">(</span><span class="nf">glue</span><span class="p">(</span><span class="s">&#34;coverage_{start}&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">head_names</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">.)[1</span><span class="o">:</span><span class="n">start</span> <span class="o">-</span> <span class="m">1</span><span class="n">]</span>
</span></span><span class="line"><span class="cl">  <span class="nf">extract</span><span class="p">(</span><span class="n">start</span><span class="o">:</span><span class="m">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">nrows</span> <span class="o">&lt;-</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">.)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">accumulate</span><span class="p">(</span><span class="n">`+`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">map_dfc</span><span class="p">(</span><span class="o">~</span> <span class="nf">length</span><span class="p">(</span><span class="nf">which</span><span class="p">(</span><span class="n">. </span><span class="o">!=</span> <span class="m">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">nrows</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pivot_longer</span><span class="p">(</span><span class="nf">everything</span><span class="p">(),</span> <span class="n">values_to</span> <span class="o">=</span> <span class="n">coverage_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="nf">tibble</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">head_names</span><span class="p">,</span> <span class="s">&#34;{coverage_name}&#34;</span> <span class="o">:=</span> <span class="m">1</span><span class="p">),</span> <span class="n">.)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">tail</span><span class="p">(</span><span class="n">tags_coverage</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## # A tibble: 6 Ã— 2
##   name         coverage_11
##   &lt;chr&gt;              &lt;dbl&gt;
## 1 winter             0.999
## 2 served.cold        0.999
## 3 fish               0.999
## 4 italian            0.999
## 5 high.protein       0.999
## 6 snacks             0.999
</code></pre><p>Therefore, it seems the first 100 tags would be sufficient for the analysis.</p>
<h2 id="a-look-at-the-100-most-popular-tags" class="relative group">A Look at the 100 Most Popular Tags <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#a-look-at-the-100-most-popular-tags" aria-label="Anchor">#</a></span></h2><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tags</span> <span class="o">%-&gt;%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">count</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nf">head</span><span class="p">(</span><span class="m">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">buckets</span> <span class="o">=</span> <span class="nf">desc</span><span class="p">(</span><span class="nf">ntile</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="m">4</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="nf">fct_reorder</span><span class="p">(</span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">.desc</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">),</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">coord_flip</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">buckets</span><span class="p">),</span> <span class="n">nrow</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">scales</span> <span class="o">=</span> <span class="s">&#34;free_y&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">geom_col</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">geom_label</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">n</span><span class="p">),</span> <span class="n">hjust</span> <span class="o">=</span> <span class="s">&#34;right&#34;</span><span class="p">,</span> <span class="n">nudge_y</span> <span class="o">=</span> <span class="m">100000</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ggtitle</span><span class="p">(</span><span class="nf">glue</span><span class="p">(</span><span class="s">&#34;Top 100 tags (of total {n_distinct(tags$tag)})&#34;</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;segment&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">y</span> <span class="o">=</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">tags_dummies</span><span class="p">),</span> <span class="n">yend</span> <span class="o">=</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">tags_dummies</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">20</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">theme</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">axis.title.y</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">      <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></div><p>





<figure>
    
    








  
    
    
    
    
      
    
    
      
    
    
    
    
    <picture  class="mx-auto my-0 rounded-md" >
      <img
        src="/posts/journey-through-tyecon/explore-tags/top-tags-1.svg"
        width="1008"
        height="576"
        class="mx-auto my-0 rounded-md"
        alt="plot of chunk top-tags"
        loading="lazy" decoding="async"
      />
    </picture>
  


</figure>
</p>
<h2 id="feature-extraction-from-tags" class="relative group">Feature Extraction from Tags <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#feature-extraction-from-tags" aria-label="Anchor">#</a></span></h2><p>From the chart, we can identify some useful tags. Of course, tags that already
cover a good proportion of the data are useless as they introduce little
variation for identification. Each tag on its own is also useless because apart
from the first few tags, each tag has very little coverage of the data. Rather,
we are looking for complementary tags or subsets that give good coverage of the
data. We can use exploratory factor analysis to identify such latent factors.
Of course, we could use PCA as well. One could even argue that since each tag
is a category, we need to use multiple correspondence analysis instead. But
this is unnecessary, since our tags are simply one-hot encoded and therefore are
just dummies that can be treated as continuous.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tags_factors</span> <span class="o">&lt;-</span> <span class="n">tags_dummies</span> <span class="o">%-&gt;%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">extract</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="nf">factanal</span><span class="p">(</span><span class="o">~</span><span class="n">.,</span> <span class="m">20</span><span class="p">,</span> <span class="n">.)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">status</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">pval</span> <span class="o">=</span> <span class="n">PVAL[[1]]</span><span class="p">,</span> <span class="n">converged</span> <span class="o">=</span> <span class="n">converged</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">use_series</span><span class="p">(</span><span class="n">loadings</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">.)</span> <span class="nf">t</span><span class="p">(</span><span class="n">.[1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">.)[1]</span><span class="p">,</span> <span class="n">]</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nf">as_tibble</span><span class="p">(</span><span class="n">rownames</span> <span class="o">=</span> <span class="s">&#34;factor&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pivot_longer</span><span class="p">(</span><span class="o">!</span><span class="n">factor</span><span class="p">,</span> <span class="s">&#34;tag&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">factor</span> <span class="o">=</span> <span class="nf">str_replace</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="s">&#34;(Factor)(.*)&#34;</span><span class="p">,</span> <span class="s">&#34;fct_\\2&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">.by_group</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">slice_head</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">set_attr</span><span class="p">(</span><span class="s">&#34;status&#34;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">tags_factors</span> <span class="o">%@%</span> <span class="s">&#34;status&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>##      pval converged 
##         0         1
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">tags_factors</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_col</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_flip</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">factor</span><span class="p">),</span> <span class="n">scales</span> <span class="o">=</span> <span class="s">&#34;free&#34;</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ylab</span><span class="p">(</span><span class="s">&#34;value in factor&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#34;Grouping of tags into latent factors&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span> <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.title.y</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><p>





<figure>
    
    








  
    
    
    
    
      
    
    
      
    
    
    
    
    <picture  class="mx-auto my-0 rounded-md" >
      <img
        src="/posts/journey-through-tyecon/explore-tags/loads-1.svg"
        width="864"
        height="576"
        class="mx-auto my-0 rounded-md"
        alt="plot of chunk loads"
        loading="lazy" decoding="async"
      />
    </picture>
  


</figure>
</p>
<p>The next step in exploratory factor analysis is to name our factors and group
our variables into said factors. I exclude ingredient tags as the recipes data
has the complete set already. Same for time to prepare. I also add dish type and
occasion which the factor analysis hasn&rsquo;t picked up.</p>
<p>The goal below is to aggregate as much of the data into groups. First creating
the names of the new variables:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tags_keep</span> <span class="o">&lt;-</span> <span class="nf">set_names</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">tags_dummies</span><span class="p">))</span> <span class="o">%$&gt;%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">dietary</span> <span class="o">&lt;-</span> <span class="n">dietary</span>
</span></span><span class="line"><span class="cl">  <span class="n">easy</span> <span class="o">&lt;-</span> <span class="n">easy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">has_occasion</span> <span class="o">&lt;-</span> <span class="n">occasion</span>
</span></span><span class="line"><span class="cl">  <span class="n">occasion</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">dinner_party</span> <span class="o">=</span> <span class="n">dinner.party</span><span class="p">,</span> <span class="n">holiday_event</span> <span class="o">=</span> <span class="n">holiday.event</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">weeknight</span> <span class="o">=</span> <span class="n">weeknight</span><span class="p">,</span> <span class="n">picnic</span> <span class="o">=</span> <span class="n">picnic</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">dish_type</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">main_dish</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">main.dish</span><span class="p">,</span> <span class="n">lunch</span><span class="p">,</span> <span class="n">breakfast</span><span class="p">,</span> <span class="n">brunch</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">desserts</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">desserts</span><span class="p">,</span> <span class="n">appetizers</span><span class="p">,</span> <span class="n">cakes</span><span class="p">,</span> <span class="n">snacks</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">bread</span> <span class="o">=</span> <span class="n">breads</span><span class="p">,</span> <span class="n">salad</span> <span class="o">=</span> <span class="n">salads</span><span class="p">,</span> <span class="n">soup</span> <span class="o">=</span> <span class="n">soups.stews</span><span class="p">,</span> <span class="n">beverage</span> <span class="o">=</span> <span class="n">beverages</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">side_dish</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">side.dishes</span><span class="p">,</span> <span class="n">desserts</span><span class="p">,</span> <span class="n">appetizers</span><span class="p">,</span> <span class="n">cakes</span><span class="p">,</span> <span class="n">snacks</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">breads</span><span class="p">,</span> <span class="n">salads</span><span class="p">,</span> <span class="n">soups.stews</span><span class="p">,</span> <span class="n">beverages</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">healthy</span> <span class="o">&lt;-</span> <span class="nf">str_subset</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\bhealthy\\b&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">low_in_something</span> <span class="o">&lt;-</span> <span class="nf">str_subset</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\blow\\b&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">high_in_something</span> <span class="o">&lt;-</span> <span class="nf">str_subset</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\bhigh\\b&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">has_cuisine</span> <span class="o">&lt;-</span> <span class="n">cuisine</span>
</span></span><span class="line"><span class="cl">  <span class="n">cuisine</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">american</span> <span class="o">=</span> <span class="nf">str_subset</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\bamerican\\b&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">european</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="nf">c</span><span class="p">(</span><span class="nf">str_subset</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\beuropean\\b&#34;</span><span class="p">),</span> <span class="nf">str_subset</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\bitalian\\b&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">asian</span> <span class="o">=</span> <span class="nf">str_subset</span><span class="p">(</span><span class="n">.,</span> <span class="s">&#34;\\basian\\b&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">has_equipment</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">equipment</span><span class="p">,</span> <span class="n">oven</span><span class="p">,</span> <span class="n">stove.top</span><span class="p">,</span> <span class="n">small.appliance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">oven</span> <span class="o">&lt;-</span> <span class="n">oven</span>
</span></span><span class="line"><span class="cl">  <span class="n">stove</span> <span class="o">&lt;-</span> <span class="n">stove.top</span>
</span></span><span class="line"><span class="cl">  <span class="n">small_appliance</span> <span class="o">&lt;-</span> <span class="n">small.appliance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">has_num_servings</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">number.of.servings</span><span class="p">,</span> <span class="n">for.1.or.2</span><span class="p">,</span> <span class="n">for.large.groups</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">serve_small</span> <span class="o">&lt;-</span> <span class="n">for.1.or.2</span>
</span></span><span class="line"><span class="cl">  <span class="n">serve_large</span> <span class="o">&lt;-</span> <span class="n">for.large.groups</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">season</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">winter</span> <span class="o">=</span> <span class="n">winter</span><span class="p">,</span> <span class="n">summer</span> <span class="o">=</span> <span class="n">summer</span><span class="p">,</span> <span class="n">fall</span> <span class="o">=</span> <span class="n">fall</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">spring</span> <span class="o">=</span> <span class="n">spring</span><span class="p">,</span> <span class="n">seasonal</span> <span class="o">=</span> <span class="n">seasonal</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">has_taste</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">taste.mood</span><span class="p">,</span> <span class="n">sweet</span><span class="p">,</span> <span class="n">savory</span><span class="p">,</span> <span class="n">spicy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">taste</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="n">sweet</span> <span class="o">=</span> <span class="n">sweet</span><span class="p">,</span> <span class="n">savory</span> <span class="o">=</span> <span class="n">savory</span><span class="p">,</span> <span class="n">spicy</span> <span class="o">=</span> <span class="n">spicy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">recipes_tags</span> <span class="o">&lt;-</span> <span class="nf">transmute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">tags_dummies</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="o">!!!</span><span class="nf">map</span><span class="p">(</span><span class="nf">flatten</span><span class="p">(</span><span class="n">tags_keep</span><span class="p">),</span> <span class="o">~</span> <span class="nf">if_else</span><span class="p">(</span><span class="nf">reduce</span><span class="p">(</span><span class="n">tags_dummies[.]</span><span class="p">,</span> <span class="n">`+`</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="n">tags_dummies</span> <span class="o">%@%</span> <span class="n">ids</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="nf">everything</span><span class="p">())</span>
</span></span></code></pre></div><p>Now our recipe tags are finally ready.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">vroom_write</span><span class="p">(</span><span class="n">recipes_tags</span><span class="p">,</span> <span class="s">&#34;~/Workspace/foodrecipes/out/recipes_tags.csv&#34;</span><span class="p">)</span>
</span></span></code></pre></div>
      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      
  <div class="flex">
    
    
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Mohamad Ali Mohamadi
        </div>
      
      
        <div class="text-sm text-neutral-700 dark:text-neutral-400">ME, Econ, DS</div>
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="TerseTears@protonmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></a
        >
      
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="https://github.com/tersetears"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></a
        >
      
    
      
        <a
          class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400"
          style="will-change:transform;"
          href="https://linkedin.com/in/mohamad-ali-mohamadi-b799582ab"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a
        >
      
    
  </div>

</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="/posts/dplyr-dataframes-part2/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >dplyr Cheatsheet to DataFrames.jl Page 2</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2021-11-13 00:00:00 &#43;0000 UTC">13 November 2021</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="/posts/journey-through-tyecon/predict-nutrs/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Journey Through `tyecon`: Predictions on Recipe Nutritions</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2022-07-02 00:00:00 &#43;0000 UTC">2 July 2022</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

      </main>
      
        <div
          class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"
          id="to-top"
          hidden="true"
        >
          <a
            href="#the-top"
            class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
            aria-label="Scroll to top"
            title="Scroll to top"
          >
            &uarr;
          </a>
        </div>
      <footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2025
            Mohamad Ali Mohamadi
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://tersetears.github.io/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
