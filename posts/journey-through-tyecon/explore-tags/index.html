<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Journey Through `tyecon`: Exploring Food.com Tags | TerseTears&#39;s Blog</title>
<meta name="keywords" content="R, tyecon" />
<meta name="description" content="Introduction I&rsquo;ve been working on my R package, tyecon for some time now. I think it can be a useful tool in performing day to day data analysis tasks. The idea is very simple: More higher order macros. There&rsquo;s no reason to focus on the handful of existing ones, like the magrittr pipes or the dplyr syntax. We have a language here that supports lazy evaluation and first class functions. This is all we need to make programming life easier.">
<meta name="author" content="">
<link rel="canonical" href="http://tersetears.github.io/posts/journey-through-tyecon/explore-tags/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css" integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js" integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://tersetears.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://tersetears.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://tersetears.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://tersetears.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="http://tersetears.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.98.0" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js" integrity="sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>


<meta property="og:title" content="Journey Through `tyecon`: Exploring Food.com Tags" />
<meta property="og:description" content="Introduction I&rsquo;ve been working on my R package, tyecon for some time now. I think it can be a useful tool in performing day to day data analysis tasks. The idea is very simple: More higher order macros. There&rsquo;s no reason to focus on the handful of existing ones, like the magrittr pipes or the dplyr syntax. We have a language here that supports lazy evaluation and first class functions. This is all we need to make programming life easier." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://tersetears.github.io/posts/journey-through-tyecon/explore-tags/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-01T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2022-06-01T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Journey Through `tyecon`: Exploring Food.com Tags"/>
<meta name="twitter:description" content="Introduction I&rsquo;ve been working on my R package, tyecon for some time now. I think it can be a useful tool in performing day to day data analysis tasks. The idea is very simple: More higher order macros. There&rsquo;s no reason to focus on the handful of existing ones, like the magrittr pipes or the dplyr syntax. We have a language here that supports lazy evaluation and first class functions. This is all we need to make programming life easier."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://tersetears.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Journey Through `tyecon`: Exploring Food.com Tags",
      "item": "http://tersetears.github.io/posts/journey-through-tyecon/explore-tags/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Journey Through `tyecon`: Exploring Food.com Tags",
  "name": "Journey Through `tyecon`: Exploring Food.com Tags",
  "description": "Introduction I\u0026rsquo;ve been working on my R package, tyecon for some time now. I think it can be a useful tool in performing day to day data analysis tasks. The idea is very simple: More higher order macros. There\u0026rsquo;s no reason to focus on the handful of existing ones, like the magrittr pipes or the dplyr syntax. We have a language here that supports lazy evaluation and first class functions. This is all we need to make programming life easier.",
  "keywords": [
    "R", "tyecon"
  ],
  "articleBody": "Introduction I’ve been working on my R package, tyecon for some time now. I think it can be a useful tool in performing day to day data analysis tasks. The idea is very simple: More higher order macros. There’s no reason to focus on the handful of existing ones, like the magrittr pipes or the dplyr syntax. We have a language here that supports lazy evaluation and first class functions. This is all we need to make programming life easier.\nData analysis tasks are quite unique. And it’s not always clear what the best approach towards writing less code could be. Nevertheless, I think searching for such possibilities is a legitimate endeavour, hence tyecon.\nIn this first part of the “Journey through tyecon” series, I explore the tags found in the Food.com dataset. I forgo mentioning specifically when I’m using any tyecon functionality, but that should be obvious from the code.\nSetup and Data Import library(tidyverse) library(tidyselect) library(magrittr) library(glue) library(vroom) library(rlang) library(tyecon)  knitr::opts_chunk$set(fig.path = \"\") knitr::opts_chunk$set(dev = 'svg') theme_set(theme_light()) set.seed(123) recipes  vroom(\"~/Workspace/foodrecipes/RAW_recipes.csv\") interacts  vroom(\"~/Workspace/foodrecipes/RAW_interactions.csv\") Tags tags  recipes %-% {  select(id, tags)  mutate(tag = str_replace_all(tags, \"[\\\\[\\\\]\\\\']\", \"\"))  select(-tags)  mutate(tag = ifelse(tag == \"\", NA, tag))  separate_rows(tag, sep = \", \")  # convert to conventional R names  mutate(tag = make.names(tag)) } Number of tags density plot:\ntags %-% {  group_by(id)  summarise(n_tags = n()) } %$% {  quantprob  0.9  quant  quantile(n_tags, quantprob)  ggplot(., aes(n_tags)) +  geom_density() +  geom_vline(xintercept = quant) +  annotate(\"label\",  quant, 0, label = glue(\"Quantile probability {quantprob}:\\n {quant}\")  ) +  xlab(\"Number of tags\") +  ylab(\"Density\") } Therefore, We would still need a lot of tags for basic exploration of our data. Let us first create the tag dummies for each submitted recipe:\ntags_dummies  tags %-% {  add_count(tag)  arrange(desc(n))  select(-n)  mutate(tagged = 1)  pivot_wider(names_from = tag, values_from = tagged, values_fill = 0)  # keep id as metadata  ids  id  select(-id)  set_attr(\"ids\", ids) } The columns of the above data frame are thus sorted in order of tag frequency.\nThe strategy is to identify how much of the data is covered by a list of tags, and to append the list with a new tag and recompute the coverage rate. Starting from highly popular tags quickly culminates in a coverage rate of 1, so we are instead interested in whether a less popular subset still covers all of our observations.\nConsequently, let’s assume a coverage rate of 1 for the first few tags and then compute the coverage rate from thereon:\ntags_coverage  tags_dummies %-% {  start  11  coverage_name  as.character(glue(\"coverage_{start}\"))  head_names  names(.)[1:start - 1]  extract(start:100)  nrows  nrow(.)  accumulate(`+`)  map_dfc(~ length(which(. != 0)) / nrows)  pivot_longer(everything(), values_to = coverage_name)  { bind_rows(tibble(name = head_names, \"{coverage_name}\" := 1), .) } } tail(tags_coverage) ## # A tibble: 6 × 2 ## name coverage_11 ##   ## 1 winter 0.999 ## 2 served.cold 0.999 ## 3 fish 0.999 ## 4 italian 0.999 ## 5 high.protein 0.999 ## 6 snacks 0.999 Therefore, it seems the first 100 tags would be sufficient for the analysis.\nA Look at the 100 Most Popular Tags tags %-% {  count(tag)  arrange(desc(n))  head(100)  mutate(buckets = desc(ntile(n, 4))) } %%  ggplot(aes(fct_reorder(fct_reorder(tag, tag, .desc = TRUE), n), n)) +  coord_flip() +  facet_wrap(vars(buckets), nrow = 1, scales = \"free_y\") +  geom_col() +  geom_label(aes(label = n), hjust = \"right\", nudge_y = 100000) +  ggtitle(glue(\"Top 100 tags (of total {n_distinct(tags$tag)})\")) +  annotate(\"segment\",  y = nrow(tags_dummies), yend = nrow(tags_dummies), x = 0, xend = 20  ) +  theme(  axis.title.y = element_blank(),  strip.text.x = element_blank()  ) Feature Extraction from Tags From the chart, we can identify some useful tags. Of course, tags that already cover a good proportion of the data are useless as they introduce little variation for identification. Each tag on its own is also useless because apart from the first few tags, each tag has very little coverage of the data. Rather, we are looking for complementary tags or subsets that give good coverage of the data. We can use exploratory factor analysis to identify such latent factors. Of course, we could use PCA as well. One could even argue that since each tag is a category, we need to use multiple correspondence analysis instead. But this is unnecessary, since our tags are simply one-hot encoded and therefore are just dummies that can be treated as continuous.\ntags_factors  tags_dummies %-% {  extract(1:100)  { factanal(~., 20, .) }  status  c(pval = PVAL[[1]], converged = converged)  use_series(loadings)  (\\(.) t(.[1:dim(.)[1], ]))  as_tibble(rownames = \"factor\")  pivot_longer(!factor, \"tag\")  mutate(  factor = str_replace(factor, \"(Factor)(.*)\", \"fct_\\\\2\"),  value = abs(value)  )  group_by(factor)  arrange(desc(value), .by_group = TRUE)  slice_head(n = 10)  set_attr(\"status\", status) } tags_factors %@% \"status\" ## pval converged ## 0 1 ggplot(tags_factors, aes(tag, value)) +  geom_col() +  coord_flip() +  facet_wrap(vars(factor), scales = \"free\", nrow = 5) +  ylab(\"value in factor\") +  ggtitle(\"Grouping of tags into latent factors\") +  theme(  axis.text.x = element_blank(), strip.text.x = element_blank(),  axis.title.y = element_blank()  ) The next step in exploratory factor analysis is to name our factors and group our variables into said factors. I exclude ingredient tags as the recipes data has the complete set already. Same for time to prepare. I also add dish type and occasion which the factor analysis hasn’t picked up.\nThe goal below is to aggregate as much of the data into groups. First creating the names of the new variables:\ntags_keep  set_names(names(tags_dummies)) %$% {  dietary  dietary  easy  easy   has_occasion  occasion  occasion  list(  dinner_party = dinner.party, holiday_event = holiday.event,  weeknight = weeknight, picnic = picnic  )   dish_type  list(  main_dish = c(main.dish, lunch, breakfast, brunch),  desserts = c(desserts, appetizers, cakes, snacks),  bread = breads, salad = salads, soup = soups.stews, beverage = beverages  )   side_dish  c(  side.dishes, desserts, appetizers, cakes, snacks,  breads, salads, soups.stews, beverages  )   healthy  str_subset(., \"\\\\bhealthy\\\\b\")  low_in_something  str_subset(., \"\\\\blow\\\\b\")  high_in_something  str_subset(., \"\\\\bhigh\\\\b\")   has_cuisine  cuisine  cuisine  list(  american = str_subset(., \"\\\\bamerican\\\\b\"),  european =  c(str_subset(., \"\\\\beuropean\\\\b\"), str_subset(., \"\\\\bitalian\\\\b\")),  asian = str_subset(., \"\\\\basian\\\\b\")  )   has_equipment  c(equipment, oven, stove.top, small.appliance)  oven  oven  stove  stove.top  small_appliance  small.appliance   has_num_servings  c(number.of.servings, for.1.or.2, for.large.groups)  serve_small  for.1.or.2  serve_large  for.large.groups   season  list(  winter = winter, summer = summer, fall = fall,  spring = spring, seasonal = seasonal  )   has_taste  c(taste.mood, sweet, savory, spicy)  taste  list(sweet = sweet, savory = savory, spicy = spicy) } recipes_tags  transmute(  tags_dummies,  !!!map(flatten(tags_keep), ~ if_else(reduce(tags_dummies[.], `+`)  0, 1, 0)) ) %%  mutate(id = tags_dummies %@% ids) %%  select(id, everything()) Now our recipe tags are finally ready.\nvroom_write(recipes_tags, \"~/Workspace/foodrecipes/out/recipes_tags.csv\") ",
  "wordCount" : "1087",
  "inLanguage": "en",
  "datePublished": "2022-06-01T00:00:00Z",
  "dateModified": "2022-06-01T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://tersetears.github.io/posts/journey-through-tyecon/explore-tags/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "TerseTears's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://tersetears.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://tersetears.github.io/" accesskey="h" title="TerseTears&#39;s Blog (Alt + H)">TerseTears&#39;s Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://tersetears.github.io/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://tersetears.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://tersetears.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Journey Through `tyecon`: Exploring Food.com Tags
    </h1>
    <div class="post-meta">01.06.2022
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#setup-and-data-import" aria-label="Setup and Data Import">Setup and Data Import</a></li>
                <li>
                    <a href="#tags" aria-label="Tags">Tags</a></li>
                <li>
                    <a href="#a-look-at-the-100-most-popular-tags" aria-label="A Look at the 100 Most Popular Tags">A Look at the 100 Most Popular Tags</a></li>
                <li>
                    <a href="#feature-extraction-from-tags" aria-label="Feature Extraction from Tags">Feature Extraction from Tags</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>I&rsquo;ve been working on my R package,
<a href="https://github.com/TerseTears/tyecon">tyecon</a> for some time now. I think it
can be a useful tool in performing day to day data analysis tasks. The idea is
very simple: More higher order macros. There&rsquo;s no reason to focus on
the handful of existing ones, like the <code>magrittr</code> pipes or the <code>dplyr</code> syntax.
We have a language here that supports lazy evaluation and first class
functions. This is all we need to make programming life easier.</p>
<p>Data analysis tasks are quite unique. And it&rsquo;s not always clear what the best
approach towards writing less code could be. Nevertheless, I think searching
for such possibilities is a legitimate endeavour, hence <code>tyecon</code>.</p>
<p>In this first part of the &ldquo;Journey through <code>tyecon</code>&rdquo; series, I explore the tags
found in the
<a href="https://www.kaggle.com/datasets/shuyangli94/food-com-recipes-and-user-interactions">Food.com</a>
dataset. I forgo mentioning specifically when I&rsquo;m using any <code>tyecon</code>
functionality, but that should be obvious from the code.</p>
<h2 id="setup-and-data-import">Setup and Data Import<a hidden class="anchor" aria-hidden="true" href="#setup-and-data-import">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(tidyverse)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(tidyselect)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(magrittr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(glue)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(vroom)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(rlang)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(tyecon)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>knitr<span style="color:#f92672">::</span>opts_chunk<span style="color:#f92672">$</span><span style="color:#a6e22e">set</span>(fig.path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>knitr<span style="color:#f92672">::</span>opts_chunk<span style="color:#f92672">$</span><span style="color:#a6e22e">set</span>(dev <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;svg&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">theme_set</span>(<span style="color:#a6e22e">theme_light</span>())
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>recipes <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vroom</span>(<span style="color:#e6db74">&#34;~/Workspace/foodrecipes/RAW_recipes.csv&#34;</span>)
</span></span><span style="display:flex;"><span>interacts <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vroom</span>(<span style="color:#e6db74">&#34;~/Workspace/foodrecipes/RAW_interactions.csv&#34;</span>)
</span></span></code></pre></div><h2 id="tags">Tags<a hidden class="anchor" aria-hidden="true" href="#tags">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tags <span style="color:#f92672">&lt;-</span> recipes <span style="color:#f92672">%-&gt;%</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(id, tags)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(tag <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace_all</span>(tags, <span style="color:#e6db74">&#34;[\\[\\]\\&#39;]&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>tags)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(tag <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>(tag <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#66d9ef">NA</span>, tag))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">separate_rows</span>(tag, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;, &#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># convert to conventional R names</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(tag <span style="color:#f92672">=</span> <span style="color:#a6e22e">make.names</span>(tag))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Number of tags density plot:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tags <span style="color:#f92672">%-&gt;%</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">group_by</span>(id)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">summarise</span>(n_tags <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>())
</span></span><span style="display:flex;"><span>} <span style="color:#f92672">%$%</span> {
</span></span><span style="display:flex;"><span>  quantprob <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.9</span>
</span></span><span style="display:flex;"><span>  quant <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">quantile</span>(n_tags, quantprob)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(., <span style="color:#a6e22e">aes</span>(n_tags)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_density</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> quant) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;label&#34;</span>,
</span></span><span style="display:flex;"><span>      quant, <span style="color:#ae81ff">0</span>, label <span style="color:#f92672">=</span> <span style="color:#a6e22e">glue</span>(<span style="color:#e6db74">&#34;Quantile probability {quantprob}:\n {quant}&#34;</span>)
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Number of tags&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Density&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img loading="lazy" src="quantile-1.svg" alt="plot of chunk quantile"  />
</p>
<p>Therefore, We would still need a lot of tags for basic exploration of our data.
Let us first create the tag dummies for each submitted recipe:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tags_dummies <span style="color:#f92672">&lt;-</span> tags <span style="color:#f92672">%-&gt;%</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">add_count</span>(tag)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(n))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>n)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(tagged <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pivot_wider</span>(names_from <span style="color:#f92672">=</span> tag, values_from <span style="color:#f92672">=</span> tagged, values_fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># keep id as metadata</span>
</span></span><span style="display:flex;"><span>  ids <span style="color:#f92672">&lt;-</span> id
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>id)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">set_attr</span>(<span style="color:#e6db74">&#34;ids&#34;</span>, ids)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The columns of the above data frame are thus sorted in order of tag frequency.</p>
<p>The strategy is to identify how much of the data is covered by a list of tags,
and to append the list with a new tag and recompute the coverage rate. Starting
from highly popular tags quickly culminates in a coverage rate of 1, so we are
instead interested in whether a less popular subset still covers all of our
observations.</p>
<p>Consequently, let&rsquo;s assume a coverage rate of 1 for the first few tags and then
compute the coverage rate from thereon:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tags_coverage <span style="color:#f92672">&lt;-</span> tags_dummies <span style="color:#f92672">%-&gt;%</span> {
</span></span><span style="display:flex;"><span>  start <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>  coverage_name <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">glue</span>(<span style="color:#e6db74">&#34;coverage_{start}&#34;</span>))
</span></span><span style="display:flex;"><span>  head_names <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">names</span>(.)[1<span style="color:#f92672">:</span>start <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">extract</span>(start<span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>  nrows <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">nrow</span>(.)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">accumulate</span>(`+`)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">map_dfc</span>(<span style="color:#f92672">~</span> <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">which</span>(. <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">/</span> nrows)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pivot_longer</span>(<span style="color:#a6e22e">everything</span>(), values_to <span style="color:#f92672">=</span> coverage_name)
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">bind_rows</span>(<span style="color:#a6e22e">tibble</span>(name <span style="color:#f92672">=</span> head_names, <span style="color:#e6db74">&#34;{coverage_name}&#34;</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>), .) }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tail</span>(tags_coverage)
</span></span></code></pre></div><pre tabindex="0"><code>## # A tibble: 6 × 2
##   name         coverage_11
##   &lt;chr&gt;              &lt;dbl&gt;
## 1 winter             0.999
## 2 served.cold        0.999
## 3 fish               0.999
## 4 italian            0.999
## 5 high.protein       0.999
## 6 snacks             0.999
</code></pre><p>Therefore, it seems the first 100 tags would be sufficient for the analysis.</p>
<h2 id="a-look-at-the-100-most-popular-tags">A Look at the 100 Most Popular Tags<a hidden class="anchor" aria-hidden="true" href="#a-look-at-the-100-most-popular-tags">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tags <span style="color:#f92672">%-&gt;%</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">count</span>(tag)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(n))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">head</span>(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(buckets <span style="color:#f92672">=</span> <span style="color:#a6e22e">desc</span>(<span style="color:#a6e22e">ntile</span>(n, <span style="color:#ae81ff">4</span>)))
</span></span><span style="display:flex;"><span>} <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(<span style="color:#a6e22e">fct_reorder</span>(<span style="color:#a6e22e">fct_reorder</span>(tag, tag, .desc <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>), n), n)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">coord_flip</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#a6e22e">vars</span>(buckets), nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;free_y&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_col</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_label</span>(<span style="color:#a6e22e">aes</span>(label <span style="color:#f92672">=</span> n), hjust <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, nudge_y <span style="color:#f92672">=</span> <span style="color:#ae81ff">100000</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#a6e22e">glue</span>(<span style="color:#e6db74">&#34;Top 100 tags (of total {n_distinct(tags$tag)})&#34;</span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;segment&#34;</span>,
</span></span><span style="display:flex;"><span>      y <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(tags_dummies), yend <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(tags_dummies), x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, xend <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>      axis.title.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
</span></span><span style="display:flex;"><span>      strip.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>()
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><p><img loading="lazy" src="top-tags-1.svg" alt="plot of chunk top-tags"  />
</p>
<h2 id="feature-extraction-from-tags">Feature Extraction from Tags<a hidden class="anchor" aria-hidden="true" href="#feature-extraction-from-tags">#</a></h2>
<p>From the chart, we can identify some useful tags. Of course, tags that already
cover a good proportion of the data are useless as they introduce little
variation for identification. Each tag on its own is also useless because apart
from the first few tags, each tag has very little coverage of the data. Rather,
we are looking for complementary tags or subsets that give good coverage of the
data. We can use exploratory factor analysis to identify such latent factors.
Of course, we could use PCA as well. One could even argue that since each tag
is a category, we need to use multiple correspondence analysis instead. But
this is unnecessary, since our tags are simply one-hot encoded and therefore are
just dummies that can be treated as continuous.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tags_factors <span style="color:#f92672">&lt;-</span> tags_dummies <span style="color:#f92672">%-&gt;%</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">extract</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">factanal</span>(<span style="color:#f92672">~</span>., <span style="color:#ae81ff">20</span>, .) }
</span></span><span style="display:flex;"><span>  status <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(pval <span style="color:#f92672">=</span> PVAL[[1]], converged <span style="color:#f92672">=</span> converged)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">use_series</span>(loadings)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">\</span>(.) <span style="color:#a6e22e">t</span>(.[1<span style="color:#f92672">:</span><span style="color:#a6e22e">dim</span>(.)[1], ]))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">as_tibble</span>(rownames <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;factor&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pivot_longer</span>(<span style="color:#f92672">!</span>factor, <span style="color:#e6db74">&#34;tag&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(
</span></span><span style="display:flex;"><span>    factor <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace</span>(factor, <span style="color:#e6db74">&#34;(Factor)(.*)&#34;</span>, <span style="color:#e6db74">&#34;fct_\\2&#34;</span>),
</span></span><span style="display:flex;"><span>    value <span style="color:#f92672">=</span> <span style="color:#a6e22e">abs</span>(value)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">group_by</span>(factor)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(value), .by_group <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">slice_head</span>(n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">set_attr</span>(<span style="color:#e6db74">&#34;status&#34;</span>, status)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>tags_factors <span style="color:#f92672">%@%</span> <span style="color:#e6db74">&#34;status&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>##      pval converged 
##         0         1
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(tags_factors, <span style="color:#a6e22e">aes</span>(tag, value)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_col</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">coord_flip</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#a6e22e">vars</span>(factor), scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;free&#34;</span>, nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;value in factor&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;Grouping of tags into latent factors&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    axis.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(), strip.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
</span></span><span style="display:flex;"><span>    axis.title.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>()
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p><img loading="lazy" src="loads-1.svg" alt="plot of chunk loads"  />
</p>
<p>The next step in exploratory factor analysis is to name our factors and group
our variables into said factors. I exclude ingredient tags as the recipes data
has the complete set already. Same for time to prepare. I also add dish type and
occasion which the factor analysis hasn&rsquo;t picked up.</p>
<p>The goal below is to aggregate as much of the data into groups. First creating
the names of the new variables:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tags_keep <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">set_names</span>(<span style="color:#a6e22e">names</span>(tags_dummies)) <span style="color:#f92672">%$&gt;%</span> {
</span></span><span style="display:flex;"><span>  dietary <span style="color:#f92672">&lt;-</span> dietary
</span></span><span style="display:flex;"><span>  easy <span style="color:#f92672">&lt;-</span> easy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  has_occasion <span style="color:#f92672">&lt;-</span> occasion
</span></span><span style="display:flex;"><span>  occasion <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    dinner_party <span style="color:#f92672">=</span> dinner.party, holiday_event <span style="color:#f92672">=</span> holiday.event,
</span></span><span style="display:flex;"><span>    weeknight <span style="color:#f92672">=</span> weeknight, picnic <span style="color:#f92672">=</span> picnic
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  dish_type <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    main_dish <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(main.dish, lunch, breakfast, brunch),
</span></span><span style="display:flex;"><span>    desserts <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(desserts, appetizers, cakes, snacks),
</span></span><span style="display:flex;"><span>    bread <span style="color:#f92672">=</span> breads, salad <span style="color:#f92672">=</span> salads, soup <span style="color:#f92672">=</span> soups.stews, beverage <span style="color:#f92672">=</span> beverages
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  side_dish <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(
</span></span><span style="display:flex;"><span>    side.dishes, desserts, appetizers, cakes, snacks,
</span></span><span style="display:flex;"><span>    breads, salads, soups.stews, beverages
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  healthy <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_subset</span>(., <span style="color:#e6db74">&#34;\\bhealthy\\b&#34;</span>)
</span></span><span style="display:flex;"><span>  low_in_something <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_subset</span>(., <span style="color:#e6db74">&#34;\\blow\\b&#34;</span>)
</span></span><span style="display:flex;"><span>  high_in_something <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_subset</span>(., <span style="color:#e6db74">&#34;\\bhigh\\b&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  has_cuisine <span style="color:#f92672">&lt;-</span> cuisine
</span></span><span style="display:flex;"><span>  cuisine <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    american <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_subset</span>(., <span style="color:#e6db74">&#34;\\bamerican\\b&#34;</span>),
</span></span><span style="display:flex;"><span>    european <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">str_subset</span>(., <span style="color:#e6db74">&#34;\\beuropean\\b&#34;</span>), <span style="color:#a6e22e">str_subset</span>(., <span style="color:#e6db74">&#34;\\bitalian\\b&#34;</span>)),
</span></span><span style="display:flex;"><span>    asian <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_subset</span>(., <span style="color:#e6db74">&#34;\\basian\\b&#34;</span>)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  has_equipment <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(equipment, oven, stove.top, small.appliance)
</span></span><span style="display:flex;"><span>  oven <span style="color:#f92672">&lt;-</span> oven
</span></span><span style="display:flex;"><span>  stove <span style="color:#f92672">&lt;-</span> stove.top
</span></span><span style="display:flex;"><span>  small_appliance <span style="color:#f92672">&lt;-</span> small.appliance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  has_num_servings <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(number.of.servings, for.1.or.2, for.large.groups)
</span></span><span style="display:flex;"><span>  serve_small <span style="color:#f92672">&lt;-</span> for.1.or.2
</span></span><span style="display:flex;"><span>  serve_large <span style="color:#f92672">&lt;-</span> for.large.groups
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  season <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    winter <span style="color:#f92672">=</span> winter, summer <span style="color:#f92672">=</span> summer, fall <span style="color:#f92672">=</span> fall,
</span></span><span style="display:flex;"><span>    spring <span style="color:#f92672">=</span> spring, seasonal <span style="color:#f92672">=</span> seasonal
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  has_taste <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(taste.mood, sweet, savory, spicy)
</span></span><span style="display:flex;"><span>  taste <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(sweet <span style="color:#f92672">=</span> sweet, savory <span style="color:#f92672">=</span> savory, spicy <span style="color:#f92672">=</span> spicy)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>recipes_tags <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">transmute</span>(
</span></span><span style="display:flex;"><span>  tags_dummies,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">!!!</span><span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">flatten</span>(tags_keep), <span style="color:#f92672">~</span> <span style="color:#a6e22e">if_else</span>(<span style="color:#a6e22e">reduce</span>(tags_dummies[.], `+`) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(id <span style="color:#f92672">=</span> tags_dummies <span style="color:#f92672">%@%</span> ids) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(id, <span style="color:#a6e22e">everything</span>())
</span></span></code></pre></div><p>Now our recipe tags are finally ready.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">vroom_write</span>(recipes_tags, <span style="color:#e6db74">&#34;~/Workspace/foodrecipes/out/recipes_tags.csv&#34;</span>)
</span></span></code></pre></div>

  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://tersetears.github.io/tags/r/">R</a></li>
      <li><a href="http://tersetears.github.io/tags/tyecon/">tyecon</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="http://tersetears.github.io/posts/dplyr-dataframes-part2/">
    <span class="title">Next Page »</span>
    <br>
    <span>dplyr Cheatsheet to DataFrames.jl Page 2</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2022 <a href="http://tersetears.github.io/">TerseTears&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
